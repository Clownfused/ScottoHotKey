; Auto-Execute:

;LoadAllProductsRaw:

rawAllProducts =
(ltrim comments %
; %
; Please list all products in the following format:
; [Part Description]								This is what will be displayed in the dropdowns
; *[Peachtree Part Number] Optional: [xQty] [$Price] [Description]		This will be added to PeachTree but won't be shown on the list
; *[Peachtree Part Number ...] 						For more than 1 part number
; [Part Description]					(optional)	Additional part that will be added to the order (for items without an existing kit)
; [Web Description]									(can span multiple lines) This is the copy-and-paste from
;														a web order that will be used to match a web order
;														with the correct product numbers.


; ##########################  Electrolarynx Kits  ###############################
; ===============================  TruTone™  ====================================

K101 - TruTone™ Basic Kit
*K101
*TT-Serial
*MDVDINST	$0
1 x  	TruTone™ Electrolarynx Kit
  - Charger and Batteries: Trickle Charger / Two Std. Batte
  - Battery Charger Voltage: 110v USA Standard
  - Buy Together and Save $30: Save money on a combo deal 		;0% 	$599.00 	$599.00 	$599.00 	$599.00

K101 - TruTone™ Basic Kit
KH100 - HandsFree™ Holder
; (Note: No product numbers are needed for multiple products)
1 x  	TruTone™ Electrolarynx Kit
  - Charger and Batteries: Trickle Charger / Two Std. Batte
  - Battery Charger Voltage: 110v USA Standard
  - Buy Together and Save $30: HandsFree™ Holder (+$119.00)

  
K116 - TruTone™ Basic Kit 220v
*K116
*TT-Serial
*MDVDINST	$0
1 x  	TruTone™ Electrolarynx Kit
  - Charger and Batteries: Trickle Charger / Two Std. Batte
  - Battery Charger Voltage: 110v and 220v USA Switchable (+$5.00)
  - Buy Together and Save $30: Save money on a combo deal 		;0% 	$604.00 	$604.00 	$604.00 	$604.00


K136 - TruTone™ w/Rapid Charger
*K136
*TT-Serial
*MDVDINST	$0
1 x  	TruTone™ Electrolarynx Kit
  - Buy Together and Save $30: Save money on a combo deal
  - Battery Charger Voltage: 110v USA Standard
  - Charger and Batteries: Rapid Charger / Two Std. Batteri (+$36.00)
; Alternate description:
  - Battery Charger Voltage: 110v and 220v USA Switchable (+$5.00)

K116 - TruTone™ Basic Kit 220v
KH100 - HandsFree™ Holder
; (Note: No product numbers are needed for multiple products)
1 x  	TruTone™ Electrolarynx Kit
  - Charger and Batteries: Trickle Charger / Two Std. Batte
  - Battery Charger Voltage: 110v and 220v USA Switchable (+$5.00)
  - Buy Together and Save $30: HandsFree™ Holder (+$119.00)

K196 - TruTone™ w/SC™
*K196
*TT-Serial
*MDVDINST	$0
1 x  	TruTone™ Electrolarynx Kit
  - Charger and Batteries: Smart Charger / 2 High Cap. Batt (+$90.00)
  - Battery Charger Voltage: 110v USA Standard
  - Buy Together and Save $30: Save money on a combo deal 		;0% 	$689.00 	$689.00 	$689.00 	$689.00

K195 - TruTone™ w/SC™/220v
*K195
*TT-Serial
*SC-Serial
*MPALDVD	$0
1 x  	TruTone™ Electrolarynx Kit
  - Charger and Batteries: Smart Charger / 2 High Cap. Batt (+$90.00)
  - Battery Charger Voltage: 110v and 220v USA Switchable (+$5.00)
  - Buy Together and Save $30: Save money on a combo deal 		;0% 	$694.00 	$694.00 	$694.00 	$694.00

K195 - TruTone™ w/SC™/220v
KH100 - HandsFree™ Holder
; (Note: No product numbers are needed for multiple products)
1 x  	TruTone™ Electrolarynx Kit
  - Charger and Batteries: Smart Charger / 2 High Cap. Batt (+$90.00)
  - Battery Charger Voltage: 110v and 220v USA Switchable (+$5.00)
  - Buy Together and Save $30: HandsFree™ Holder (+$119.00) 		;0% 	$813.00 	$813.00 	$813.00 	$813.00

K197 - TruTone™ w/SC™/HF™
*K197
*TT-Serial
*SC-Serial
*MDVDINST	$0
1 x  	TruTone™ Electrolarynx Kit
  - Charger and Batteries: Smart Charger / 2 High Cap. Batt (+$90.00)
  - Battery Charger Voltage: 110v USA Standard
  - Buy Together and Save $30: HandsFree™ Holder (+$119.00) 		;0% 	$808.00 	$808.00 	$808.00 	$808.00
  
KH100 - HandsFree™ Holder
*KH100
1 x 	HandsFree™ electrolarynx holder 		;0% 	$149.00 	$149.00 	$149.00 	$149.00
  
; ==========================  SolaTone™  ==================================

K206 - SolaTone™ Basic
*K206
*ST-Serial
*MDVDINST	$0
1 x 	SolaTone™ Electrolarynx
  - Charger and Batteries: No Charger / One Alkaline Batter
  - Battery Charger Voltage: 110v USA Standard
  - Buy Together and Save $30: Save money on a combo deal 		;0% 	$449.00 	$449.00 	$449.00 	$449.00

K276 - SolaTone™ w/Trickle Charger
*K276
*ST-Serial
*MDVDINST	$0
1 x  	SolaTone™ Electrolarynx
  - Charger and Batteries: Trickle Charger / Two Std. Batte (+$25.00)
  - Battery Charger Voltage: 110v USA Standard
  - Buy Together and Save $30: Save money on a combo deal 		;0% 	$474.00 	$474.00 	$474.00 	$474.00

K206 - SolaTone™ Basic
Rapid Charger
; (Note: No product numbers are needed for multiple products)
1 x  	SolaTone™ Electrolarynx
  - Charger and Batteries: Rapid Charger / Two Std. Batteri (+$49.00)
  - Battery Charger Voltage: 110v USA Standard
  - Buy Together and Save $30: Save money on a combo deal

K206 - SolaTone™ Basic
KH100 - HandsFree™ Holder
; (Note: No product numbers are needed for multiple products)
1 x  	SolaTone™ Electrolarynx
  - Charger and Batteries: No Charger / One Alkaline Batter
  - Battery Charger Voltage: 110v USA Standard
  - Buy Together and Save $30: HandsFree™ Holder (+$119.00)

  
; ##########################  Amplifiers  ###############################

; SoniVox:
K600 - SoniVox™ Basic
*K600
*SV-Serial
1 x  	SoniVox™ Waistband Amplifier
  - Headset Choice: Heavy Duty High-Fidelity mic (Fr 		;0% 	$249.00 	$249.00 	$249.00 	$249.00

K601 - SoniVox™ w/Noise-Canceling Mic
*K601
*SV-Serial
1 x 	SoniVox™ Waistband Amplifier
  - Headset Choice: Low Profile Noise-Canceling mic (+$75.00) 		;0% 	$324.00 	$324.00 	$324.00 	$324.00

; SoniVox Both Mics:
K600 - SoniVox™ Basic
Low Profile Noise-Canceling Mic
; (Note: No product numbers are needed for multiple products)
1 x  	SoniVox™ Waistband Amplifier
  - Headset Choice: Both microphones (+$109.00)

; BoomVox  
K650 - BoomVox™ Wireless Voice Amplifier
*K650
*BV-Serial
1 x  	BoomVox™ Wireless Amplifier
  - Color: Black
  - Headset Choice: Heavy Duty High-Fidelity mic (Fr
; Alternate options:
  - Color: White / Ivory

K651 - BoomVox™ w/Noise-Canceling Mic
*K651
*BV-Serial
1 x  	BoomVox™ Wireless Amplifier
  - Headset Choice: Low Profile Noise-Canceling mic (+$75.00)
  - Color: Black
; Alternate options:
  - Color: White / Ivory

; BoomVox Both Mics:
K650 - BoomVox™ Wireless Voice Amplifier
Low Profile Noise-Canceling Mic
; (Note: No product numbers are needed for multiple products)
1 x  	BoomVox™ Wireless Amplifier
  - Color: Black
  - Headset Choice: Both microphones (+$109.00)
; Alternate options:
  - Color: White / Ivory

  
; ##########################  Parts  ###############################

;** Chargers **
Rapid Charger
*50753	$26.99
1 x  	9v Rapid Charger  	 	;0%  	$26.99  	$26.99  	$26.99  	$26.99

;** TT Replacement Parts **
TruTone™ Battery Cap
*40000 ; Battery Cap
*50310 ; Spring
1 x  	TruTone™ Speech Aid Battery Cap

Rubber Diaphragm
*50385 x2 $14.99 ; Website says it comes with 2.
1 x  	Rubber Diaphragm for Centering Coil 

Electrolarynx Tune-Up Kit (TruTone™)
*22200 $12.99	Electrolarynx Tune-Up Kit (Lanyard) ; Lanyard 
*50305 $0		Electrolarynx Tune-Up Kit (Foam Ring) ; Foam Ring
*20200 $0		Electrolarynx Tune-Up Kit (Screwdriver) ; Electrolarynx Tone-Adjustment Screwdriver
*20000 $0		Electrolarynx Tune-Up Kit (TruTone™ Label) ; Instrument Label 
1 x  	Electrolarynx Tune-Up Kit
  - Label Type: TruTone™ Label

Electrolarynx Tune-Up Kit (SolaTone™)
*22200 $12.99	Electrolarynx Tune-Up Kit (Lanyard) ; Lanyard 
*50305 $0		Electrolarynx Tune-Up Kit (Foam Ring) ; Foam Ring
*20200 $0		Electrolarynx Tune-Up Kit (Screwdriver) ; Electrolarynx Tone-Adjustment Screwdriver
*21000 $0		Electrolarynx Tune-Up Kit (SolaTone™ Label) ; Instrument Label 
1 x  	Electrolarynx Tune-Up Kit
  - Label Type: SolaTone™ Label

Lanyard for TruTone™ - 2 Pack
*22200 x2 $4.99
1 x  	Lanyard for Electrolarynx - 2 Pack

Sound Head Cap (TruTone™)
*S30050
1 x  	TruTone™ Speech Aid Sound-Head Cap
  - TruTone™ ALD Sound Button: Standard TruTone™ ALD sound

Sound Head Cap (TruTone™ Extra Sharp)
*S30051
1 x  	TruTone™ Speech Aid Sound-Head Cap
  - TruTone™ ALD Sound Button: Sharper sounding Sound Button


;** Batteries **
BATTERY - 9v Rechargeable (High-Capacity)
*50439 $15.99
1 x  	9v Rechargeable Battery--High Capacity  	 	;0%  	$15.99  	$15.99  	$31.98  	$31.98

BATTERY - 9v Rechargeable (Standard-Capacity)
*50438 $9.99
1 x  	9v Rechargeable Battery--Standard Capacity 

; ** Oral Adapter **
Oral Adapter - Mixed Straws
*50445 ; Oral Adapter
*S50450 x2 $0 ;S50450 = Mixed, S50452 = Clear, S50453 = White (we need 2 of these, because our website says it comes with 8)  
1 x  	Oral Adapter for Artificial Larynx Devices
  - Oral straws: Variety pack

Oral Adapter - Clear Straws
*50445 ; Oral Adapter
*S50452 x2 $0 ;S50450 = Mixed, S50452 = Clear, S50453 = White (we need 2 of these, because our website says it comes with 8)  
1 x  	Oral Adapter for Artificial Larynx Devices
  - Oral straws: All clear, soft straws 		;8.75% 	$24.99 	$24.99 	$24.99 	$24.99

Oral Adapter - White Straws
*50445 ; Oral Adapter
*S50453 x2 $0 ;S50450 = Mixed, S50452 = Clear, S50453 = White (we need 2 of these, because our website says it comes with 8)  
1 x  	Oral Adapter for Artificial Larynx Devices
  - Oral straws: All White; rigid straws

; ** Oral Straws **
Oral Straws - Mixed 12 pack
*S50450 x3 $2.99 ;S50450 = Mixed, S50452 = Clear, S50453 = White
1 x  	Oral Straws for Electrolaryx
  - Oral straws: Variety pack

Oral Straws - Clear 12 pack
*S50452 x3  $2.99 ;S50450 = Mixed, S50452 = Clear, S50453 = White
1 x  	Oral Straws for Electrolarynx
  - Oral straws: All clear, soft straws

Oral Straws - White 12 pack
*S50453 x3  $2.99 ;S50450 = Mixed, S50452 = Clear, S50453 = White
1 x  	Oral Straws for Electrolarynx
  - Oral straws: All White; rigid straws

Demo DVD (NTSC)
*MDVDINST
1 x  	Electrolarynx Instructional & Demo DVD Video 

Demo DVD (PAL)
*MPALDVD
1 x  	Electrolarynx Instructional & Demo DVD Video 

Sanitary Covers (Natural)
*Unknown
1 x  	Sanitary Protective Covers - 5 Pack (Natural Color) 

Sanitary Covers (Black)
*Unknown
1 x  	Sanitary Protective Covers - 5 Pack (Black)

;** Amplifier Accessories **
Low Profile Noise-Canceling Mic
*MIC-SLHM $109.00
1 x  	Low Profile Noise-Canceling Headset Microphone 

Battery for BoomVox™
*50433 $29.99
1 x  	BoomVox™ Amplifier Replacement Battery 

;%;######################## It is necessary to have at least one more blank line below this one! ##############################

)




































; This variable is used by Peachtree.ahk
; Product Number Syntax:
; *50000    x40    $29.99    Custom description for this product.
;    ^       ^       ^         ^
; PT Number [Qty]  [Price]   [Description]      ;[] = optional
ProductNumberPattern = ix)^ (?<Num>\S*) \s+ (x(?<Qty>[0-9.]+))? \s* (\$(?<Price>[0-9.]+))? \s* (?<Desc>.*) $

;LoadAllProducts:
	;GoSub LoadAllProductsRaw

	ProductTitles =
	ProductNumbers =
	;ProductDescriptions =
	ProductWebDescriptions =
	ProductList =

	productIndex = 0
	varName =

	Loop, parse, rawAllProducts, `n
	{	; Take apart our products list and get the Titles, Numbers, Descriptions, and Web Descriptions of each:
		lastVarName := varName

		If A_LoopField =
		{	varName =
			continue
		}

		fullLine := A_LoopField
		
		varName = ProductTitles
		If RegexMatch(fullLine, "^\*")
			varName = ProductNumbers
		If RegexMatch(fullLine, "^(\d+ x |- )")
			varName = ProductWebDescriptions
			
		
		If varName = ProductTitles
			If lastVarName =
				productIndex++
		
		; Append the current line to the selected variable:
		If (%varName%%productIndex% != "")
			%varName%%productIndex% .= "`n"
		%varName%%productIndex% .= fullLine
	}
	

	;productIndex--
	ProductCount := productIndex
	
	; Create a pipe-separated list of product titles:
	ProductList =
	Loop %ProductCount%
	{	IfInString ProductTitles%A_Index%, `n
			continue ; We can't allow multiple products in our products list
		;If ProductList !=
			ProductList .= "|"
		ProductList .= ProductTitles%A_Index%
	}
Return

































































FindAllProducts(webItems, TitleOrDescriptionOrWebOrNumbersOrIndex = "INDEX", ByRef orderItems1 = "", ByRef orderItems2 = "", ByRef orderItems3 = "", ByRef orderItems4 = "", ByRef orderItems5 = "", ByRef orderItems6 = "", ByRef orderItemsQty1 = "", ByRef orderItemsQty2 = "", ByRef orderItemsQty3 = "", ByRef orderItemsQty4 = "", ByRef orderItemsQty5 = "", ByRef orderItemsQty6 = "") {
	
	; Break apart all webItems:
	startIndex = 1
	webItemIndex = 0
	; Break apart all webItems into an array:
	Loop
	{
		startIndex := RegexMatch(webItems, "s)(?<Qty>\d+) x +.*?(?=[.0-9]+%)", item, startIndex) 		;%;%;%;%
		If startIndex = 0
			break
		startIndex += StrLen(item)
		webItemIndex++

		If webItemIndex > 6
		{	MsgBox There are more than 6 items detected!  The maximum is 6, so the additional items will have to be entered manually.
			break
		}

		
		webItems%webItemIndex% := item
		webItemsQty%webItemIndex% := itemQty

		
	}

	; Find all the product titles from the web descriptions:
	orderItemsCount = 0
	orderItemsQty1 =
	orderItemsQty2 =
	orderItemsQty3 =
	orderItemsQty4 =
	orderItemsQty5 =
	orderItemsQty6 =
	productTitles =
	Loop %webItemIndex%
	{
		; Find the new products from the web description:
		newProducts := FindProduct(webItems%A_Index%, "TITLE")

		; Add the new products to the list of products:
		If productTitles !=
			productTitles .= "`n"
		productTitles .= newProducts
		
		; Set the quantity for all these new products:
		productQty := webItemsQty%A_Index%
		Loop, parse, newProducts, `n
		{	orderItemsCount++
			orderItemsQty%orderItemsCount% := productQty
		}
		
	}

	
	
	orderItems1 =
	orderItems2 =
	orderItems3 =
	orderItems4 =
	orderItems5 =
	orderItems6 =
	; Get all the outputs from the product titles:
	Loop parse, productTitles, `n
	{
		orderItems%A_Index% := FindProduct(A_LoopField, TitleOrDescriptionOrWebOrNumbersOrIndex)
	}

	Return %webItemIndex%
}
FindProduct(description, TitleOrDescriptionOrWebOrNumbersOrIndex = "INDEX") {
	global
	; global ProductCount
	; global ProductTitles
	; global ProductNumbers
	; ;global ProductDescriptions
	; global ProductWebDescriptions
	; global ProductList
	If (description = "") OR (description = 1)
		Return TitleOrDescriptionOrWebOrNumbersOrIndex = "INDEX" ? 1 : ""
	
	; If ProductCount =
		; GoSub LoadAllProducts
	
	If description is Integer
	{	; Search the ProductList to get the title of this index:
		Loop, parse, ProductList, |
		{	If (A_Index = description) {
				description := A_LoopField
				break
			}
		}
	}

	;originalDescription := description ; (Debug)
	;description := RegexReplace(description, "\s+", "") ; Remove all white space
	productIndex =
	Loop, %ProductCount%
	{	If CompareProducts(description, A_Index) = true {
			productIndex := A_Index
			break
		}
	}
	Gui +OwnDialogs
	If productIndex =  ; (Debug)
		msgbox Couldn't find the following description in the Products file:`n%description%
	
	If productIndex =		; No product found
		Return TitleOrDescriptionOrWebOrNumbersOrIndex = "INDEX" ? 1 : ""
			
	
	If TitleOrDescriptionOrWebOrNumbersOrIndex = TITLE
		Return ProductTitles%productIndex%
	If TitleOrDescriptionOrWebOrNumbersOrIndex = DESCRIPTION
		Return ProductDescriptions%productIndex%
	If TitleOrDescriptionOrWebOrNumbersOrIndex = WEB
		Return ProductWebDescriptions%productIndex%
	If TitleOrDescriptionOrWebOrNumbersOrIndex = NUMBERS
		Return ProductNumbers%productIndex%
	;If TitleOrDescriptionOrWebOrNumbersOrIndex = INDEX
		Loop, parse, ProductList, |
			If (ProductTitles%productIndex% = A_LoopField)
				Return A_Index
		Return 1
}





;;; Compares the description with the productIndex and returns True if they are the same
CompareProducts(description, productIndex) {
	global
	; local webpattern
	; local item, itemTitle, itemOptions, itemOptions0, itemOptions1, itemOptions2, itemOptions3, itemOptions4, itemOptions5, itemOptions6
	; local webItem, webItemTitle, webItemOptions, webItemOptions0, webItemOptions1, webItemOptions2, webItemOptions3, webItemOptions4, webItemOptions5, webItemOptions6
	; Compare the description to the title, ignoring whitespace:
	If (RegexReplace(description,"\s+","") = RegexReplace(ProductTitles%productIndex%, "\s+", ""))
		Return true
	
	; Compare the web description:
	
	webpattern =
	(ltrim join
		ixs)
		(?<QTY>\d+) \s+ x \s+ (?<Title>.*?)\n?
		(?<Options>.*)
	)
	If  RegexMatch(description, webpattern, item) {
		RegexMatch(ProductWebDescriptions%productIndex%, webpattern, webItem)
		
		itemOptions := RegexReplace(itemOptions,"[ \r\t]+","") ; Remove whitespace except for `n
		webItemOptions := RegexReplace(webItemOptions,"[ \r\t]+","") ; Remove whitespace except for `n
		StringSplit itemOptions, itemOptions, `n
		StringSplit webItemOptions, webItemOptions, `n
		

		local isContained
		Loop %itemOptions0%
		{	isContained := false
			itemIndex := A_Index
			Loop %webItemOptions0%
				If (itemOptions%itemIndex% = webItemOptions%A_Index%)
					isContained := true
			
			If (Not isContained)
				return false
		}
		Return true
		; If (webItemOptions0 != itemOptions0)
			; Return false
		; local isContained
		; Loop %webItemOptions0%
		; {	isContained := false
			; webIndex := A_Index
			; Loop %itemOptions0%
				; If (itemOptions%A_Index% = webItemOptions%webIndex%)
					; isContained := true

			; If Not isContained
				; return false
		; }
		; Return true
	} 

		


	Return false
}


